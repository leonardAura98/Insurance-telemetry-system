<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Users - Admin Panel</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="sidebar">
        <h2>Admin Panel</h2>
        <ul>
            <li><a href="admin_dashboard.html">Dashboard</a></li>
            <li><a href="admin_users.html">Manage Users</a></li>
            <li><a href="admin_vehicles.html">Manage Vehicles</a></li>
            <li><a href="admin_premiums.html">Manage Premiums</a></li>
            <li><a href="../php/auth.php?action=logout">Logout</a></li>
        </ul>
    </div>
    <div class="container">
        <h2>Manage Users</h2>

        <!-- Search and Filter -->
        <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <div style="display: flex; gap: 1rem;">
                <input type="text" id="search-input" placeholder="Search users..." style="flex: 1;">
                <select id="role-filter">
                    <option value="">All Roles</option>
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
                <button onclick="filterUsers()">Filter</button>
            </div>
        </div>

        <!-- Users Table -->
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="users-list">
                <!-- Users will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        function fetchUsers() {
            fetch('../php/admin.php?action=fetch_users')
                .then(response => response.json())
                .then(data => {
                    let usersHtml = '';
                    data.forEach(user => {
                        usersHtml += `
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.fullname}</td>
                                <td>${user.email}</td>
                                <td>${user.username}</td>
                                <td>${user.role}</td>
                                <td>
                                    <button onclick="editUser(${user.id})" style="background: #2196F3;">Edit</button>
                                    <button onclick="deleteUser(${user.id})" style="background: #f44336;">Delete</button>
                                </td>
                            </tr>
                        `;
                    });
                    document.getElementById('users-list').innerHTML = usersHtml;
                })
                .catch(error => console.error('Error:', error));
        }

        function filterUsers() {
            const searchTerm = document.getElementById('search-input').value;
            const roleFilter = document.getElementById('role-filter').value;
            
            fetch(`../php/admin.php?action=fetch_users&search=${searchTerm}&role=${roleFilter}`)
                .then(response => response.json())
                .then(data => {
                    // Update table with filtered data
                    // Similar to fetchUsers() implementation
                })
                .catch(error => console.error('Error:', error));
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                fetch('../php/admin.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `action=delete_user&id=${userId}`
                })
                .then(response => response.text())
                .then(result => {
                    alert(result);
                    fetchUsers();
                })
                .catch(error => console.error('Error:', error));
            }
        }

        // Load users on page load
        document.addEventListener('DOMContentLoaded', fetchUsers);
    </script>
</body>
</html>
