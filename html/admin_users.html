<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Users - Admin Panel</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav class="top-nav">
        <div class="nav-brand">
            <h1>Admin Panel</h1>
        </div>
        <ul class="nav-links">
            <li><a href="admin_dashboard.html">Dashboard</a></li>
            <li><a href="admin_users.html" class="active">Users</a></li>
            <li><a href="admin_vehicles.html">Vehicles</a></li>
            <li><a href="admin_premiums.html">Premiums</a></li>
            <li><a href="management_signin.html">Logout</a></li>
        </ul>
    </nav>

    <div class="container">
        <h2>Manage Users</h2>

        <!-- Search and Filter -->
        <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <div style="display: flex; gap: 1rem;">
                <input type="text" id="search-input" placeholder="Search users..." style="flex: 1;">
                <select id="role-filter">
                    <option value="">All Roles</option>
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
                <button onclick="filterUsers()">Filter</button>
            </div>
        </div>

        <!-- Users Table -->
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="users-list">
                <!-- Users will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        function fetchUsers() {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '<tr><td colspan="6">Loading users...</td></tr>';
            
            fetch('../php/admin.php?action=fetch_users')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    let usersHtml = '';
                    if (data.length === 0) {
                        usersHtml = '<tr><td colspan="6">No users found</td></tr>';
                    } else {
                        data.forEach(user => {
                            usersHtml += `
                                <tr>
                                    <td>${user.id}</td>
                                    <td>${user.username}</td>
                                    <td>${user.email}</td>
                                    <td>${user.id_number}</td>
                                    <td>${user.role}</td>
                                    <td>
                                        <button onclick="editUser(${user.id})" class="btn-edit">Edit</button>
                                        <button onclick="deleteUser(${user.id})" class="btn-delete">Delete</button>
                                    </td>
                                </tr>
                            `;
                        });
                    }
                    usersList.innerHTML = usersHtml;
                })
                .catch(error => {
                    console.error('Error:', error);
                    usersList.innerHTML = '<tr><td colspan="6">Error loading users</td></tr>';
                });
        }

        function filterUsers() {
            const searchTerm = document.getElementById('search-input').value;
            const roleFilter = document.getElementById('role-filter').value;
            
            fetch(`../php/admin.php?action=fetch_users&search=${searchTerm}&role=${roleFilter}`)
                .then(response => response.json())
                .then(data => {
                    // Update table with filtered data
                    // Similar to fetchUsers() implementation
                })
                .catch(error => console.error('Error:', error));
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                fetch('../php/admin.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `action=delete_user&id=${userId}`
                })
                .then(response => response.text())
                .then(result => {
                    alert(result);
                    fetchUsers();
                })
                .catch(error => console.error('Error:', error));
            }
        }

        // Load users on page load
        document.addEventListener('DOMContentLoaded', fetchUsers);

        // Toggle sidebar visibility
        document.getElementById('sidebar').addEventListener('mouseover', function() {
            this.style.width = '250px';
        });
        document.getElementById('sidebar').addEventListener('mouseout', function() {
            this.style.width = '60px';
        });

        function handleLogout() {
            fetch('../php/logout.php')
                .then(response => response.json())
                .then(data => {
                    showMessage('success', 'Logged out successfully');
                    setTimeout(() => {
                        window.location.href = 'management_signin.html';
                    }, 1500);
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
<script src="../js/feedback.js"></script>
<script src="../js/dashboard.js"></script>
<script src="../js/admin.js"></script></body>
</html>
