<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Details - Insurance System</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h2><a href="landing.html">Insurance System</a></h2>
        <ul>
            <li><a href="home.html">Dashboard</a></li>
            <li><a href="vehicledetails.html">Vehicle Details</a></li>
            <li><a href="driverdetails.html">Driver Details</a></li>
            <li><a href="premiumcalculator.html">Premium Calculator</a></li>
            <li><a href="landing.html">Logout</a></li>
        </ul>
    </div>
    <div class="container">
        <h2>Driver Profile</h2>

        <!-- Profile Information -->
        <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 2rem;">
            <h3>Personal Information</h3>
            <form id="profile-form" style="max-width: 100%; box-shadow: none; padding: 0;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <input type="text" name="fullname" placeholder="Full Name" required>
                    <input type="email" name="email" placeholder="Email" required>
                    <input type="tel" name="phone" placeholder="Phone Number" required>
                    <input type="text" name="license" placeholder="Driver's License Number" required>
                    <input type="number" name="experience" placeholder="Years of Experience" required>
                    <input type="date" name="dob" placeholder="Date of Birth" required>
                </div>
                <button type="submit" style="margin-top: 1rem;">Update Profile</button>
            </form>
        </div>

        <!-- Driving History -->
        <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 2rem;">
            <h3>Driving History</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Incident Type</th>
                        <th>Description</th>
                        <th>Impact on Premium</th>
                    </tr>
                </thead>
                <tbody id="driving-history">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Toggle sidebar visibility
        document.getElementById('sidebar').addEventListener('mouseover', function() {
            this.style.width = '250px';
        });
        document.getElementById('sidebar').addEventListener('mouseout', function() {
            this.style.width = '60px';
        });

        // Fetch and populate profile data
        fetch('../php/user.php?action=get_profile')
            .then(response => response.json())
            .then(data => {
                Object.keys(data).forEach(key => {
                    const input = document.querySelector(`input[name="${key}"]`);
                    if (input) input.value = data[key];
                });
            })
            .catch(error => console.error('Error:', error));

        // Handle profile form submission
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            formData.append('action', 'update_profile');

            fetch('../php/user.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(result => {
                alert('Profile updated successfully!');
            })
            .catch(error => console.error('Error:', error));
        });

        // Fetch driving history
        fetch('../php/user.php?action=get_driving_history')
            .then(response => response.json())
            .then(data => {
                let historyHtml = '';
                data.forEach(record => {
                    historyHtml += `
                        <tr>
                            <td>${record.date}</td>
                            <td>${record.type}</td>
                            <td>${record.description}</td>
                            <td>${record.impact}</td>
                        </tr>
                    `;
                });
                document.getElementById('driving-history').innerHTML = historyHtml;
            })
            .catch(error => console.error('Error:', error));
    </script>
    <script src="../js/feedback.js"></script>
</body>
</html>
